{% load static %}
{% load templateTags %}
<!DOCTYPE html>
<html lang="en-GB">
<head>
    <title>BookRec</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
          integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"
            integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <link rel="stylesheet" href="https://sliderm.com/dist/1.0.8/sliderm.css">
    <script src="https://sliderm.com/dist/1.0.8/sliderm.js"></script>
</head>
{% navigationPanel request as navigationPanel %}
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="#">BookRec</a>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav ml-auto">
            {% for panel in navigationPanel %}
                {% if not panel.subLinks %}
                    <li class="nav-item active">
                        <a class="nav-link" href="{{ panel.url }}" data-toggle="tooltip" data-placement="right"
                           title="{{ panel.name }}">
                            {% if panel.icon %}{{ panel.icon|safe }}{% endif %} {{ panel.name }}
                        </a>
                    </li>
                {% else %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            {% if panel.icon %}{{ panel.icon|safe }}{% endif %} {{ panel.name }}
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                            {% for subLink in panel.subLinks %}
                                {% if subLink %}
                                    <a class="dropdown-item"
                                       href="{{ subLink.url }}"> {{ subLink.icon|safe }} {{ subLink.name }}</a>
                                {% else %}
                                    <div class="dropdown-divider"></div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </li>
                {% endif %}
            {% endfor %}
        </ul>
    </div>
</nav>
<div class="container">
    {% if messages %}
        {% for msg in messages %}
            <div style="color: black; text-align: center;"
                 class="alert alert-{% if msg.tags == "error" %}danger{% else %}{{ msg.tags }}{% endif %}"
                 role="alert">{{ msg|safe }}
            </div>
        {% endfor %}
    {% endif %}
</div>
<style>
    .invalid-feedback {
        text-align: center;
    }
</style>
{% block content %}
{% endblock %}
</body>
<script>

    function getCookie(name) {
        let cookieValue = null;

        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');

            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();

                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    function buildCarousel(books, _carouselContent, bookCarousel) {
        if (books === [])
            return;

        const booksPerSlide = 4;
        const slideInterval = 3000;

        const carouselContent = document.getElementById(_carouselContent);

        for (let i = 0; i < books.length; i += booksPerSlide) {
            const carouselItem = document.createElement("div");
            carouselItem.className = "carousel-item" + (i === 0 ? " active" : "");

            const row = document.createElement("div");
            row.className = "row no-gutters";

            const slideBooks = books.slice(i, i + booksPerSlide);
            slideBooks.forEach(book => {
                const col = document.createElement("div");
                col.className = `col-${12 / booksPerSlide}`;

                col.innerHTML = `
                    <div class="book-card text-center">
                        <a style='cursor: pointer;' href='${book.url}'>
                            <img src="${book.thumbnail}" alt="${book.title}" style="height: 300px; width: 200px;">
                            <h6 class="mt-2">${book.title}</h6>
                         </a>
                    </div>
                  `;

                row.appendChild(col);
            });

            carouselItem.appendChild(row);
            carouselContent.appendChild(carouselItem);
        }

        $('#' + bookCarousel).carousel({
            interval: slideInterval
        });
    }

</script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
</html>